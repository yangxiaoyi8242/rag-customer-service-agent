# TRAE环境调试手册

## 1. 项目概述

本项目是一个基于TRAE Solo模式开发的「Windows本地RAG客户问答Agent」，使用豆包LLM和审核后本地资料实现精准问答，同时支持资料更新、日志记录等实用功能。

### 核心功能
- 基础问答：基于本地资料的精准检索和回答
- 资料更新：自动检测文件变更并重建向量库
- 日志记录：将问答记录保存到本地日志文件
- 容错处理：适配Windows中文路径、文件权限等场景

## 2. 环境准备

### 2.1 必要依赖
- Python 3.8+
- pip 包管理工具

### 2.2 项目结构
```
AI coding- Talk Agent/
├── data_loader.py        # 数据加载和向量库构建模块
├── rag_core.py           # RAG核心逻辑和LLM调用模块
├── log_handler.py        # 日志记录模块
├── main.py               # 主程序模块
├── start_rag_agent.bat   # Windows一键启动脚本
├── 审核后资料文件夹/      # 存放审核后的资料文件
├── vector_db/            # 向量库存储目录
└── logs/                 # 日志文件存储目录
```

## 3. 快速启动

### 3.1 首次运行
1. **准备资料**：将审核后的资料文件放入「审核后资料文件夹」
2. **配置API密钥**：在`main.py`中替换`doubao_api_key`为实际的豆包API密钥
3. **双击启动**：双击`start_rag_agent.bat`脚本
4. **等待初始化**：首次运行会自动安装依赖并构建向量库

### 3.2 常规运行
- 直接双击`start_rag_agent.bat`脚本即可启动
- 系统会自动检查资料更新并更新向量库

## 4. 功能测试

### 4.1 基础问答测试
1. **启动系统**：运行`start_rag_agent.bat`
2. **输入问题**：在命令行中输入与资料相关的问题
3. **验证回答**：检查回答是否基于资料内容，是否准确
4. **测试边界**：输入与资料无关的问题，验证是否正确触发转人工逻辑

### 4.2 资料更新测试
1. **启动系统**：运行`start_rag_agent.bat`
2. **添加/修改资料**：在「审核后资料文件夹」中添加新文件或修改现有文件
3. **输入问题**：再次输入问题，系统应自动检测到文件变更并重建向量库
4. **验证更新**：输入与新添加内容相关的问题，检查回答是否包含新信息

### 4.3 日志记录测试
1. **启动系统**：运行`start_rag_agent.bat`
2. **输入多个问题**：与系统进行多轮对话
3. **检查日志**：在`logs`目录中查看生成的日志文件，验证是否包含完整的问答记录

### 4.4 容错处理测试
1. **中文路径测试**：使用包含中文的文件和文件夹名称
2. **文件权限测试**：尝试读取权限不足的文件
3. **API调用测试**：测试API密钥错误或网络超时的情况

## 5. 代码调试

### 5.1 常见问题排查

| 问题 | 可能原因 | 解决方案 |
|------|---------|----------|
| 依赖安装失败 | 网络问题或Python版本不兼容 | 检查网络连接，确保Python版本≥3.8 |
| 向量库构建失败 | 资料文件格式错误或编码问题 | 检查文件编码是否为UTF-8，确保文件可正常读取 |
| API调用失败 | API密钥错误或网络问题 | 检查API密钥是否正确，确保网络连接正常 |
| 回答不准确 | 资料质量差或检索参数不合适 | 优化资料质量，调整`top_k`和相似度阈值 |

### 5.2 调试技巧
1. **启用详细日志**：在代码中添加`print`语句或使用Python调试器
2. **检查向量库**：验证向量库是否正确构建，可通过查看`vector_db`目录
3. **测试嵌入模型**：单独测试文本嵌入功能，确保嵌入模型正常工作
4. **API调用测试**：使用Postman等工具测试豆包API是否可正常调用

## 6. 扩展修改

### 6.1 配置参数修改
- **资料目录**：修改`main.py`中的`data_dir`配置
- **向量库参数**：修改`data_loader.py`中的`chunk_size`和`chunk_overlap`
- **检索参数**：修改`rag_core.py`中的`top_k`和相似度阈值
- **日志配置**：修改`log_handler.py`中的日志格式和存储位置

### 6.2 功能扩展
- **支持更多文件格式**：在`data_loader.py`中添加对PDF、Word等格式的支持
- **优化嵌入模型**：替换为更适合特定领域的嵌入模型
- **添加用户界面**：开发Web或桌面GUI界面
- **集成其他LLM**：添加对其他大语言模型的支持

### 6.3 性能优化
- **向量库优化**：使用FAISS的IVF索引加速检索
- **缓存机制**：添加查询缓存，避免重复计算
- **并行处理**：使用多线程加速文件处理和嵌入计算
- **模型量化**：使用量化技术减小模型大小和加速推理

## 7. 部署建议

### 7.1 本地部署
- **适合场景**：个人使用或小团队内部使用
- **部署步骤**：直接使用`start_rag_agent.bat`启动
- **注意事项**：确保有足够的磁盘空间存储向量库和日志

### 7.2 TRAE部署
- **适合场景**：需要在TRAE环境中集成或扩展
- **部署步骤**：
  1. 将项目文件复制到TRAE工作目录
  2. 按照TRAE的Python项目部署规范进行配置
  3. 使用TRAE的任务调度功能定期更新向量库

## 8. 故障排除

### 8.1 常见错误及解决方案

1. **`ModuleNotFoundError`**
   - 原因：缺少依赖包
   - 解决方案：运行`pip install -r requirements.txt`安装依赖

2. **`FileNotFoundError`**
   - 原因：文件路径错误或文件不存在
   - 解决方案：检查文件路径是否正确，确保文件存在

3. **`PermissionError`**
   - 原因：文件权限不足
   - 解决方案：以管理员身份运行脚本，或修改文件权限

4. **API调用超时**
   - 原因：网络问题或API服务器繁忙
   - 解决方案：检查网络连接，稍后重试

### 8.2 日志分析
- **日志位置**：`logs`目录下的`rag_chat_YYYYMMDD.txt`文件
- **日志内容**：包含问题、回答、检索片段和时间戳
- **分析方法**：通过查看日志可以了解系统运行状态和用户交互情况

## 9. 版本管理

### 9.1 版本控制
- 建议使用Git进行版本控制
- 忽略`vector_db`和`logs`目录，只跟踪代码文件

### 9.2 更新记录
- **v1.0.0**：初始版本，实现基础问答、资料更新和日志记录功能
- **v1.1.0**：添加容错处理，优化用户体验
- **v1.2.0**：性能优化，支持更多文件格式

## 10. 联系方式

如有问题或建议，请联系项目维护者：
- 邮箱：support@example.com
- 微信：RAGAgentSupport

---

**注意**：本手册仅供TRAE环境调试使用，实际部署时请根据具体环境进行调整。